<!DOCTYPE html>
<html lang="ur">
<head>
  <meta charset="UTF-8">
  <title>Naqsh Maker</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 10px;
      margin: 0;
    }
    h1 {
      text-align: center;
      font-size: clamp(20px, 4vw, 32px);
    }
    h2, h3 {
      text-align: center;
      font-size: clamp(16px, 3vw, 24px);
    }
    input {
      margin: 5px;
      padding: 10px;
      font-size: clamp(14px, 3vw, 18px);
      width: min(90%, 250px);
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      padding: 10px 20px;
      font-size: clamp(14px, 3vw, 18px);
      margin: 10px;
      border-radius: 6px;
      border: none;
      background: #0077cc;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #005fa3;
    }
    #results {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      margin-top: 20px;
      width:100%;
    }
    .naqsh-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      padding: 10px;
      width: 100%;
      max-width: 400px;
      overflow-x: auto;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      min-width: 280px;
    }
    td {
      border: 1px solid #333;
      text-align: center;
      font-size: clamp(12px, 3vw, 18px);
      padding: 6px;
      word-break: break-word;
    }
    .sum {
      font-weight: bold;
      background: #f0f0f0;
    }
    .info {
      text-align: center;
      margin: 5px 0;
      font-size: clamp(12px, 2.5vw, 16px);
    }
    .input-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 10px 0;
    }
    @media (min-width: 600px) {
      .input-area {
        flex-direction: row;
        justify-content: center;
      }
    }
    /* download button wrapper */
    .pdf-btn-wrap { text-align:center; margin-top:8px; width:100% }
    #downloadBtn { display:none; background:#28a745; }
    #downloadBtn:hover { background:#1e7e34; }
  </style>

  <!-- include html2canvas and jsPDF (used for robust PDF creation) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <h1>Naqsh Maker</h1>
  <div class="input-area">
    <input id="name1" placeholder="Ÿæ€ÅŸÑÿß ŸÜÿßŸÖ ÿØÿ±ÿ¨ ⁄©ÿ±€å⁄∫">
    <input id="name2" placeholder="ÿØŸàÿ≥ÿ±ÿß ŸÜÿßŸÖ ÿØÿ±ÿ¨ ⁄©ÿ±€å⁄∫">
    <button onclick="makeNaqsh()">ÿ®ŸÜÿßŸÜÿß ÿ¥ÿ±Ÿàÿπ ⁄©ÿ±€å⁄∫</button>
  </div>

  <div id="results"></div>

  <div class="pdf-btn-wrap">
    <button id="downloadBtn" onclick="downloadPDF()">üì• Download PDF (4 pages)</button>
  </div>

<script>
/* ----------------- original logic & improved PDF support ----------------- */

const abjad = {
  'ÿß':1,'ÿ®':2,'ÿ¨':3,'ÿØ':4,'Ÿá':5,'Ÿà':6,'ÿ≤':7,'ÿ≠':8,'ÿ∑':9,
  '€å':10,'ÿ¶':10,'⁄©':20,'ŸÑ':30,'ŸÖ':40,'ŸÜ':50,'ÿ≥':60,'ÿπ':70,
  'ŸÅ':80,'ÿµ':90,'ŸÇ':100,'ÿ±':200,'ÿ¥':300,'ÿ™':400,'ÿ´':500,
  'ÿÆ':600,'ÿ∞':700,'ÿ∂':800,'ÿ∏':900,'ÿ∫':1000
};

const layouts = {
  aatshi: [8,11,14,1, 13,2,7,12, 3,16,9,6, 10,5,4,15],
  baadi:  [11,8,1,14, 2,13,12,7, 16,3,6,9, 5,10,15,4],
  aabi:   [14,1,8,11, 7,12,13,2, 9,6,3,16, 4,15,10,5],
  khaaki: [1,14,11,8, 12,7,2,13, 6,9,16,3, 15,4,5,10]
};

const smallLayouts = {
  aatshi: [7,10,13,null, 12,1,6,11, 2,15,8,5, 9,4,3,14],
  baadi:  [10,7,null,13, 1,12,11,6, 15,2,5,8, 4,9,14,3],
  aabi:   [13,null,7,10, 6,11,12,1, 8,5,2,15, 3,14,9,4],
  khaaki: [null,13,10,7, 11,6,1,12, 5,8,15,2, 14,3,4,9]
};

/* pdfData holds generated items grouped by style; used by downloadPDF() */
let pdfData = { aatshi: [], baadi: [], aabi: [], khaaki: [] };

function getPairs(name1, name2){
  let arr1 = name1.replace(/\s+/g,'').split('');
  let arr2 = name2.replace(/\s+/g,'').split('');
  let maxLen = Math.max(arr1.length, arr2.length);
  let pairs=[];
  for(let i=0;i<maxLen;i++){
    pairs.push([arr1[i%arr1.length], arr2[i%arr2.length]]);
  }
  return pairs;
}

function buildNaqsh(type, quotient, remainder, smallCase){
  let grid = Array(16).fill('');
  if(smallCase){
    let layout = smallLayouts[type];
    layout.forEach((val, idx)=>{
      if(val!==null) grid[idx] = val;
    });
  } else {
    let nums = [];
    for(let i=0;i<16;i++) nums.push(quotient+i);

    if(remainder > 0){
      let startIndex = remainder===1 ? 12 : remainder===2 ? 8 : 4; 
      for(let i=startIndex; i<16; i++){
        nums[i] += 1;
      }
    }

    let layout = layouts[type];
    layout.forEach((khana, idx)=>{
      grid[idx] = nums[khana-1];
    });
  }
  return grid;
}

function computeRowColSumsFromGridArray(grid){
  const rows = [
    grid.slice(0,4),
    grid.slice(4,8),
    grid.slice(8,12),
    grid.slice(12,16)
  ];
  const rowSums = rows.map(r => r.reduce((s, v)=> s + (+v || 0), 0));
  const colSums = [0,0,0,0];
  for(let r=0;r<4;r++) for(let c=0;c<4;c++) colSums[c] += (+rows[r][c] || 0);
  return { rows, rowSums, colSums };
}

function renderNaqsh(title, grid){
  const { rows, rowSums, colSums } = computeRowColSumsFromGridArray(grid);
  let html = `<div class="naqsh-container"><h3>${title}</h3><table>`;
  for(let i=0;i<4;i++){
    html+="<tr>";
    for(let j=0;j<4;j++){
      html+=`<td>${rows[i][j]||''}</td>`;
    }
    html+=`<td class="sum">${rowSums[i]}</td></tr>`;
  }
  html+="<tr>";
  for(let j=0;j<4;j++){
    html+=`<td class="sum">${colSums[j]}</td>`;
  }
  html+="<td></td></tr>";
  html+="</table></div>";
  return html;
}

function makeNaqsh(){
  const name1 = document.getElementById('name1').value.trim();
  const name2 = document.getElementById('name2').value.trim();
  const results = document.getElementById('results');
  results.innerHTML = '';

  // reset stored pdf data
  pdfData = { aatshi: [], baadi: [], aabi: [], khaaki: [] };

  if(!name1 || !name2){ alert('Enter both names'); return; }

  const pairs = getPairs(name1, name2);
  pairs.forEach((pair, idx) => {
    const letterA = pair[0], letterB = pair[1];
    const valA = abjad[letterA] || 0;
    const valB = abjad[letterB] || 0;
    const product = valA * valB;

    let html = `<div class="naqsh-container"><h2>Pair ${idx+1}: ${letterA} , ${letterB}</h2>`;
    html += `<div class="info">Product=${product}</div>`;

    if(product <= 33){
      const gA = buildNaqsh('aatshi',0,0,true);
      const gB = buildNaqsh('baadi',0,0,true);
      const gC = buildNaqsh('aabi',0,0,true);
      const gD = buildNaqsh('khaaki',0,0,true);

      html += renderNaqsh("Aatshi (‚â§33)", gA);
      html += renderNaqsh("Baadi (‚â§33)", gB);
      html += renderNaqsh("Aabi (‚â§33)", gC);
      html += renderNaqsh("Khaaki (‚â§33)", gD);

      // store for PDF
      pdfData.aatshi.push({ letterA, letterB, valA, valB, product, type: 'Aatshi (‚â§33)', grid: gA });
      pdfData.baadi.push({ letterA, letterB, valA, valB, product, type: 'Baadi (‚â§33)', grid: gB });
      pdfData.aabi.push({ letterA, letterB, valA, valB, product, type: 'Aabi (‚â§33)', grid: gC });
      pdfData.khaaki.push({ letterA, letterB, valA, valB, product, type: 'Khaaki (‚â§33)', grid: gD });

    } else {
      const modified = product - 30;
      const quotient = Math.floor(modified / 4);
      const remainder = modified % 4;
      html += `<div class="info">Quotient=${quotient}, Remainder=${remainder}</div>`;

      const gA = buildNaqsh('aatshi', quotient, remainder, false);
      const gB = buildNaqsh('baadi', quotient, remainder, false);
      const gC = buildNaqsh('aabi', quotient, remainder, false);
      const gD = buildNaqsh('khaaki', quotient, remainder, false);

      html += renderNaqsh("Aatshi", gA);
      html += renderNaqsh("Baadi", gB);
      html += renderNaqsh("Aabi", gC);
      html += renderNaqsh("Khaaki", gD);

      // store for PDF
      pdfData.aatshi.push({ letterA, letterB, valA, valB, product, modified, quotient, remainder, type: 'Aatshi', grid: gA });
      pdfData.baadi.push({ letterA, letterB, valA, valB, product, modified, quotient, remainder, type: 'Baadi', grid: gB });
      pdfData.aabi.push({ letterA, letterB, valA, valB, product, modified, quotient, remainder, type: 'Aabi', grid: gC });
      pdfData.khaaki.push({ letterA, letterB, valA, valB, product, modified, quotient, remainder, type: 'Khaaki', grid: gD });
    }

    html += `</div>`;
    results.innerHTML += html;
  });

  // show the download button now that we have stored data
  document.getElementById('downloadBtn').style.display = 'inline-block';
}

/* ----- robust PDF creation: build one page per style using html2canvas + jsPDF ----- */
async function downloadPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: 'pt', format: 'a4' });
  const pageWidth = doc.internal.pageSize.getWidth();
  const pageHeight = doc.internal.pageSize.getHeight();
  const margin = 20;

  const pages = [
    { title: 'All AATSHI Naqshs', items: pdfData.aatshi },
    { title: 'All BAADI Naqshs', items: pdfData.baadi },
    { title: 'All AABI Naqshs', items: pdfData.aabi },
    { title: 'All KHAAKI Naqshs', items: pdfData.khaaki }
  ];

  // helper to create an HTML snapshot for a style (off-DOM)
  function buildStyleSnapshot(title, items){
    const container = document.createElement('div');
    container.style.boxSizing = 'border-box';
    container.style.width = (pageWidth - margin*2) + 'px';
    container.style.fontFamily = 'Arial, sans-serif';
    container.style.padding = '8px';
    container.style.background = '#ffffff';
    container.style.color = '#000000';

    const h = document.createElement('h2');
    h.textContent = title;
    h.style.margin = '6px 0 10px';
    container.appendChild(h);

    if(items.length === 0){
      const p = document.createElement('div');
      p.textContent = 'No naqshs for this style.';
      container.appendChild(p);
      return container;
    }

    items.forEach((it, idx) => {
      const info = document.createElement('div');
      info.style.fontSize = '11px';
      info.style.marginBottom = '6px';
      let infoText = `Pair ${idx+1}: ${it.letterA} , ${it.letterB} ‚Äî Abjad: ${it.valA} , ${it.valB} ‚Äî Product: ${it.product}`;
      if(it.modified !== undefined) infoText += ` ‚Äî Adj: ${it.modified}, Q=${it.quotient}, R=${it.remainder}`;
      info.textContent = infoText;
      container.appendChild(info);

      // table
      const table = document.createElement('table');
      table.style.borderCollapse = 'collapse';
      table.style.marginBottom = '12px';
      table.style.width = '100%';
      table.style.fontSize = '11px';

      // compute rows & sums from it.grid
      const comp = computeRowColSumsFromGridArray(it.grid);
      for(let r=0;r<4;r++){
        const tr = document.createElement('tr');
        for(let c=0;c<4;c++){
          const td = document.createElement('td');
          td.style.border = '1px solid #222';
          td.style.padding = '6px';
          td.style.textAlign = 'center';
          td.textContent = comp.rows[r][c] || '';
          tr.appendChild(td);
        }
        const sumTd = document.createElement('td');
        sumTd.style.border = '1px solid #222';
        sumTd.style.padding = '6px';
        sumTd.style.textAlign = 'center';
        sumTd.style.fontWeight = '700';
        sumTd.style.background = '#f0f0f0';
        sumTd.textContent = comp.rowSums[r];
        tr.appendChild(sumTd);
        table.appendChild(tr);
      }
      // bottom col sums
      const trSum = document.createElement('tr');
      for(let c=0;c<4;c++){
        const td = document.createElement('td');
        td.style.border = '1px solid #222';
        td.style.padding = '6px';
        td.style.textAlign = 'center';
        td.style.fontWeight = '700';
        td.style.background = '#f0f0f0';
        td.textContent = comp.colSums[c];
        trSum.appendChild(td);
      }
      const corner = document.createElement('td');
      corner.style.border = '1px solid #222';
      corner.style.padding = '6px';
      corner.style.background = '#f0f0f0';
      corner.textContent = '';
      trSum.appendChild(corner);
      table.appendChild(trSum);

      container.appendChild(table);
    });

    return container;
  }

  // render each style page to the PDF
  for(let p=0; p<pages.length; p++){
    const page = pages[p];
    const snap = buildStyleSnapshot(page.title, page.items);

    // append temporarily to body but offscreen so fonts/styles load
    snap.style.position = 'fixed';
    snap.style.left = '-9999px';
    document.body.appendChild(snap);

    // use html2canvas to produce high-res canvas (scale)
    // scale chosen to get good resolution on A4
    const scale = 2.0;
    const canvas = await html2canvas(snap, { scale: scale, useCORS: true, allowTaint: true });
    const imgData = canvas.toDataURL('image/png');

    // compute dimensions to fit page while preserving aspect ratio
    const imgWidth = pageWidth - margin*2;
    const imgHeight = (canvas.height * imgWidth) / canvas.width;

    if(p > 0) doc.addPage();
    doc.addImage(imgData, 'PNG', margin, margin, imgWidth, imgHeight);

    // remove offscreen snapshot
    document.body.removeChild(snap);
  }

  // save
  doc.save('naqsh_all_styles.pdf');
}
</script>
</body>
</html>
