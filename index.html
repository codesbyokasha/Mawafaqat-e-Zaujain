<!DOCTYPE html>
<html lang="ur">
<head>
  <meta charset="UTF-8">
  <title>Naqsh Maker</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin:0; padding:10px; }
    h1 { text-align: center; font-size: clamp(20px, 4vw, 32px); }
    h2, h3 { text-align: center; font-size: clamp(16px, 3vw, 24px); }
    input, button { margin: 5px; padding: 10px; font-size: clamp(14px, 3vw, 18px); border-radius: 6px; }
    input { width: min(90%, 250px); border: 1px solid #ccc; }
    button { background: #0077cc; color: white; border: none; cursor: pointer; }
    button:hover { background: #005fa3; }
    #results { margin-top: 20px; display: flex; flex-direction: column; align-items: center; gap: 20px; }
    .naqsh-container { background: white; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.2); padding: 10px; width: 100%; max-width: 400px; }
    table { border-collapse: collapse; width: 100%; min-width: 280px; }
    td { border: 1px solid #333; text-align: center; font-size: clamp(12px, 3vw, 18px); padding: 6px; }
    .sum { font-weight: bold; background: #f0f0f0; }
    .info { text-align: center; font-size: clamp(12px, 2.5vw, 16px); margin: 5px 0; }
  </style>
</head>
<body>
  <h1>Naqsh Maker</h1>
  <div style="text-align:center;">
    <input id="name1" placeholder="پہلا نام درج کریں">
    <input id="name2" placeholder="دوسرا نام درج کریں">
    <button onclick="makeNaqsh()">بنانا شروع کریں</button>
  </div>
  <div id="results"></div>
  <div style="text-align:center; margin-top:20px;">
    <button id="downloadBtn" style="display:none;" onclick="downloadPDF()">Download All Naqshs (PDF)</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
const abjad = {
  'ا':1,'ب':2,'ج':3,'د':4,'ه':5,'و':6,'ز':7,'ح':8,'ط':9,
  'ی':10,'ئ':10,'ک':20,'ل':30,'م':40,'ن':50,'س':60,'ع':70,
  'ف':80,'ص':90,'ق':100,'ر':200,'ش':300,'ت':400,'ث':500,
  'خ':600,'ذ':700,'ض':800,'ظ':900,'غ':1000
};

const layouts = {
  aatshi: [8,11,14,1, 13,2,7,12, 3,16,9,6, 10,5,4,15],
  baadi:  [11,8,1,14, 2,13,12,7, 16,3,6,9, 5,10,15,4],
  aabi:   [14,1,8,11, 7,12,13,2, 9,6,3,16, 4,15,10,5],
  khaaki: [1,14,11,8, 12,7,2,13, 6,9,16,3, 15,4,5,10]
};

const smallLayouts = {
  aatshi: [7,10,13,null, 12,1,6,11, 2,15,8,5, 9,4,3,14],
  baadi:  [10,7,null,13, 1,12,11,6, 15,2,5,8, 4,9,14,3],
  aabi:   [13,null,7,10, 6,11,12,1, 8,5,2,15, 3,14,9,4],
  khaaki: [null,13,10,7, 11,6,1,12, 5,8,15,2, 14,3,4,9]
};

let pdfData = { aatshi: [], baadi: [], aabi: [], khaaki: [] };

function getPairs(name1, name2){
  let arr1 = name1.replace(/\s+/g,'').split('');
  let arr2 = name2.replace(/\s+/g,'').split('');
  let maxLen = Math.max(arr1.length, arr2.length);
  let pairs=[];
  for(let i=0;i<maxLen;i++){
    pairs.push([arr1[i%arr1.length], arr2[i%arr2.length]]);
  }
  return pairs;
}

function buildNaqsh(type, quotient, remainder, smallCase){
  let grid = Array(16).fill('');
  if(smallCase){
    let layout = smallLayouts[type];
    layout.forEach((val, idx)=>{
      if(val!==null) grid[idx] = val;
    });
  } else {
    let nums = [];
    for(let i=0;i<16;i++) nums.push(quotient+i);

    if(remainder > 0){
      let startIndex = remainder===1 ? 12 : remainder===2 ? 8 : 4; 
      for(let i=startIndex; i<16; i++){
        nums[i] += 1;
      }
    }

    let layout = layouts[type];
    layout.forEach((khana, idx)=>{
      grid[idx] = nums[khana-1];
    });
  }
  return grid;
}

function renderNaqsh(title, grid){
  let rows = [grid.slice(0,4), grid.slice(4,8), grid.slice(8,12), grid.slice(12,16)];
  let rowSums = rows.map(r=>r.reduce((a,b)=>a+(+b||0),0));
  let colSums = [0,0,0,0];
  for(let r=0;r<4;r++){
    for(let c=0;c<4;c++){
      colSums[c]+= (+rows[r][c]||0);
    }
  }

  let html = `<div class="naqsh-container"><h3>${title}</h3><table>`;
  for(let i=0;i<4;i++){
    html+="<tr>";
    for(let j=0;j<4;j++){
      html+=`<td>${rows[i][j]||''}</td>`;
    }
    html+=`<td class="sum">${rowSums[i]}</td></tr>`;
  }
  html+="<tr>";
  for(let j=0;j<4;j++){
    html+=`<td class="sum">${colSums[j]}</td>`;
  }
  html+="<td></td></tr>";
  html+="</table></div>";
  return html;
}

function makeNaqsh(){
  let name1=document.getElementById('name1').value.trim();
  let name2=document.getElementById('name2').value.trim();
  let results=document.getElementById('results');
  results.innerHTML='';
  pdfData = { aatshi: [], baadi: [], aabi: [], khaaki: [] };
  if(!name1||!name2){alert('Enter both names');return;}
  
  let pairs=getPairs(name1,name2);
  pairs.forEach((pair,idx)=>{
    let val1=abjad[pair[0]]||0;
    let val2=abjad[pair[1]]||0;
    let product=val1*val2;
    if(product<=33){
      ["aatshi","baadi","aabi","khaaki"].forEach(type=>{
        let grid=buildNaqsh(type,0,0,true);
        pdfData[type].push({pair:pair, val1, val2, product, grid});
      });
    } else {
      let modified=product-30;
      let quotient=Math.floor(modified/4);
      let remainder=modified%4;
      ["aatshi","baadi","aabi","khaaki"].forEach(type=>{
        let grid=buildNaqsh(type,quotient,remainder,false);
        pdfData[type].push({pair:pair, val1, val2, product, modified, quotient, remainder, grid});
      });
    }
  });

  // Preview (group by type)
  ["aatshi","baadi","aabi","khaaki"].forEach(type=>{
    let html=`<h2>${type.toUpperCase()} Naqshs</h2>`;
    pdfData[type].forEach((it,idx)=>{
      html+=`<div class="info">Pair ${idx+1}: ${it.pair[0]} , ${it.pair[1]} — Product: ${it.product}</div>`;
      html+=renderNaqsh(type.toUpperCase(), it.grid);
    });
    results.innerHTML+=html;
  });

  document.getElementById('downloadBtn').style.display='inline-block';
}

async function downloadPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: 'pt', format: 'a4' });
  const pageWidth = doc.internal.pageSize.getWidth();
  const pageHeight = doc.internal.pageSize.getHeight();
  const margin = 20;

  const container = document.createElement('div');
  container.style.width = (pageWidth - margin*2) + 'px';
  container.style.fontFamily = 'Arial, sans-serif';
  container.style.fontSize = '11px';
  container.style.background = '#fff';
  document.body.appendChild(container);

  const order = ["aatshi","baadi","aabi","khaaki"];
  order.forEach(type=>{
    if(pdfData[type].length===0) return;
    const h=document.createElement('h2');
    h.textContent=type.toUpperCase()+" Naqshs";
    container.appendChild(h);

    pdfData[type].forEach((it,idx)=>{
      const info=document.createElement('div');
      info.textContent=`Pair ${idx+1}: ${it.pair[0]} , ${it.pair[1]} — Product: ${it.product}`;
      container.appendChild(info);

      const table=document.createElement('table');
      table.style.borderCollapse='collapse';
      table.style.marginBottom='8px';
      table.style.width='100%';

      const rows=[it.grid.slice(0,4),it.grid.slice(4,8),it.grid.slice(8,12),it.grid.slice(12,16)];
      const rowSums=rows.map(r=>r.reduce((a,b)=>a+(+b||0),0));
      const colSums=[0,0,0,0]; for(let r=0;r<4;r++) for(let c=0;c<4;c++) colSums[c]+= (+rows[r][c]||0);

      for(let r=0;r<4;r++){
        const tr=document.createElement('tr');
        for(let c=0;c<4;c++){
          const td=document.createElement('td');
          td.textContent=rows[r][c]||'';
          td.style.border='1px solid #222';
          td.style.padding='4px';
          tr.appendChild(td);
        }
        const sumTd=document.createElement('td');
        sumTd.textContent=rowSums[r];
        sumTd.style.border='1px solid #222';
        sumTd.style.fontWeight='700';
        tr.appendChild(sumTd);
        table.appendChild(tr);
      }
      const tr=document.createElement('tr');
      for(let c=0;c<4;c++){
        const td=document.createElement('td');
        td.textContent=colSums[c];
        td.style.border='1px solid #222';
        td.style.fontWeight='700';
        tr.appendChild(td);
      }
      const empty=document.createElement('td'); tr.appendChild(empty);
      table.appendChild(tr);

      container.appendChild(table);
    });
  });

  const canvas=await html2canvas(container,{scale:2});
  const imgData=canvas.toDataURL('image/png');
  const imgWidth=pageWidth - margin*2;
  const imgHeight=(canvas.height*imgWidth)/canvas.width;
  let heightLeft=imgHeight;
  let position=margin;

  doc.addImage(imgData,'PNG',margin,position,imgWidth,imgHeight);
  heightLeft-= (pageHeight - margin*2);

  while(heightLeft>0){
    position=heightLeft-imgHeight+margin;
    doc.addPage();
    doc.addImage(imgData,'PNG',margin,position,imgWidth,imgHeight);
    heightLeft-= (pageHeight - margin*2);
  }

  document.body.removeChild(container);
  doc.save('naqsh_all.pdf');
}
</script>
</body>
</html>
